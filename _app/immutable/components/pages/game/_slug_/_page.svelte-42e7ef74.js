import{S as K,i as Y,s as F,k as w,l as b,m as E,h as d,n as k,b as O,B as R,H as U,o as se,I as he,q as D,r as T,G as f,u as Z,J as me,a as P,w as x,c as W,x as ee,K as pe,y as te,L as _e,M as Q,f as I,g as fe,t as N,d as de,z as re,N as ge,O as ve}from"../../../../chunks/index-c52228b5.js";import{s as J,b as ye,C as we,a as G,c as be,P as ie}from"../../../../chunks/ws-3563c1cd.js";import{p as Se}from"../../../../chunks/stores-d019234d.js";function ke(a){let e;return{c(){e=w("canvas"),this.h()},l(r){e=b(r,"CANVAS",{class:!0}),E(e).forEach(d),this.h()},h(){k(e,"class","svelte-10wxk2q")},m(r,t){O(r,e,t),a[6](e)},p:R,i:R,o:R,d(r){r&&d(e),a[6](null)}}}function Ee(a,e,r){let t;U(a,J,c=>r(5,t=c));let{parentWidth:s}=e,{parentHeight:n}=e,o,m,l,u,i;const $=(c,g)=>{let y;return()=>{clearTimeout(y),y=setTimeout(()=>c(),g)}};function z(){const c=Math.min(s/o,n/m);return{width:o*c,height:m*c}}se(()=>(ye.subscribe(c=>{!c||requestAnimationFrame(()=>{c.forEach(g=>{A(g)})})}),i=u.getContext("2d"),window.addEventListener("resize",$(v,100)),()=>{window.removeEventListener("resize",$(v,100))}));function v(){l=z();const c=l.width,g=l.height,y=(c+g)/(o+m);i.canvas.width=c,i.canvas.height=g,i.fillStyle=we.BG,i.fillRect(0,0,c,g);for(let p=0;p<=c;p+=y)i.moveTo(p,0),i.lineTo(p,g);for(let p=0;p<=g;p+=y)i.moveTo(0,p),i.lineTo(c,p);i.stroke()}function A(c){const g=l.width,y=l.height,p=(g+y)/(c.grid.x+c.grid.y),B=c.snake;for(let H=0;H<B.length;H++){const L=B[H];i.fillStyle="#"+Math.floor(Math.random()*16777215).toString(16),i.fillRect(L.x*p,L.y*p,p,p)}}function M(c){he[c?"unshift":"push"](()=>{u=c,r(0,u)})}return a.$$set=c=>{"parentWidth"in c&&r(1,s=c.parentWidth),"parentHeight"in c&&r(2,n=c.parentHeight)},a.$$.update=()=>{a.$$.dirty&32&&(r(4,m=t.board.height),r(3,o=t.board.width)),a.$$.dirty&24&&(m||o)&&v()},[u,s,n,o,m,t,M]}class $e extends K{constructor(e){super(),Y(this,e,Ee,ke,F,{parentWidth:1,parentHeight:2})}}function Ae(a){let e,r;return{c(){e=w("span"),r=D(a[0]),this.h()},l(t){e=b(t,"SPAN",{class:!0});var s=E(e);r=T(s,a[0]),s.forEach(d),this.h()},h(){k(e,"class","svelte-1tzmdj2")},m(t,s){O(t,e,s),f(e,r)},p(t,[s]){s&1&&Z(r,t[0])},i:R,o:R,d(t){t&&d(e)}}}function Me(a,e,r){let t=5,s;return se(()=>{r(1,s=setInterval(()=>{r(0,t-=1)},1e3))}),me(()=>{clearInterval(s)}),a.$$.update=()=>{a.$$.dirty&3&&t===0&&s&&(clearInterval(s),r(1,s=null))},[t,s]}class je extends K{constructor(e){super(),Y(this,e,Me,Ae,F,{})}}function ce(a){let e,r;return e=new je({}),{c(){x(e.$$.fragment)},l(t){ee(e.$$.fragment,t)},m(t,s){te(e,t,s),r=!0},i(t){r||(I(e.$$.fragment,t),r=!0)},o(t){N(e.$$.fragment,t),r=!1},d(t){re(e,t)}}}function De(a){let e,r,t,s,n,o,m,l=a[2].gameStatus==="count-down"&&ce();return t=new $e({props:{parentWidth:a[0],parentHeight:a[1]}}),{c(){e=w("div"),l&&l.c(),r=P(),x(t.$$.fragment),this.h()},l(u){e=b(u,"DIV",{class:!0});var i=E(e);l&&l.l(i),r=W(i),ee(t.$$.fragment,i),i.forEach(d),this.h()},h(){k(e,"class","game-container svelte-ktws0q"),pe(()=>a[4].call(e))},m(u,i){O(u,e,i),l&&l.m(e,null),f(e,r),te(t,e,null),s=_e(e,a[4].bind(e)),n=!0,o||(m=Q(window,"keydown",a[3]),o=!0)},p(u,[i]){u[2].gameStatus==="count-down"?l?i&4&&I(l,1):(l=ce(),l.c(),I(l,1),l.m(e,r)):l&&(fe(),N(l,1,1,()=>{l=null}),de());const $={};i&1&&($.parentWidth=u[0]),i&2&&($.parentHeight=u[1]),t.$set($)},i(u){n||(I(l),I(t.$$.fragment,u),n=!0)},o(u){N(l),N(t.$$.fragment,u),n=!1},d(u){u&&d(e),l&&l.d(),re(t),s(),o=!1,m()}}}function Te(a,e,r){let t;U(a,J,l=>r(2,t=l));let s,n;function o(l){var u=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"];u.indexOf(l.code)!=-1&&G({type:"movement",msg:l.code})}function m(){s=this.offsetWidth,n=this.offsetHeight,r(0,s),r(1,n)}return[s,n,t,o,m]}class He extends K{constructor(e){super(),Y(this,e,Te,De,F,{})}}function Ie(a){let e,r,t,s,n,o,m,l,u,i,$,z;return{c(){e=w("div"),r=w("div"),t=w("h2"),s=D("Ouch..."),n=P(),o=w("a"),m=D("\xD7"),l=P(),u=w("div"),i=D(a[0]),this.h()},l(v){e=b(v,"DIV",{class:!0});var A=E(e);r=b(A,"DIV",{class:!0});var M=E(r);t=b(M,"H2",{class:!0});var c=E(t);s=T(c,"Ouch..."),c.forEach(d),n=W(M),o=b(M,"A",{href:!0,class:!0});var g=E(o);m=T(g,"\xD7"),g.forEach(d),l=W(M),u=b(M,"DIV",{class:!0});var y=E(u);i=T(y,a[0]),y.forEach(d),M.forEach(d),A.forEach(d),this.h()},h(){k(t,"class","svelte-1xf2rsa"),k(o,"href","/#"),k(o,"class","close svelte-1xf2rsa"),k(u,"class","content svelte-1xf2rsa"),k(r,"class","popup svelte-1xf2rsa"),k(e,"class","overlay svelte-1xf2rsa")},m(v,A){O(v,e,A),f(e,r),f(r,t),f(t,s),f(r,n),f(r,o),f(o,m),f(r,l),f(r,u),f(u,i),$||(z=Q(o,"click",a[1]),$=!0)},p(v,[A]){A&1&&Z(i,v[0])},i:R,o:R,d(v){v&&d(e),$=!1,z()}}}function Re(a,e,r){let t;U(a,J,o=>r(2,t=o));let{errorMsg:s}=e;const n=()=>{ge(J,t.error=void 0,t)};return a.$$set=o=>{"errorMsg"in o&&r(0,s=o.errorMsg)},[s,n]}class ze extends K{constructor(e){super(),Y(this,e,Re,Ie,F,{errorMsg:0})}}function Ce(a){let e,r,t,s;return{c(){e=w("button"),r=D("Ready")},l(n){e=b(n,"BUTTON",{});var o=E(e);r=T(o,"Ready"),o.forEach(d)},m(n,o){O(n,e,o),f(e,r),t||(s=Q(e,"click",a[4]),t=!0)},p:R,d(n){n&&d(e),t=!1,s()}}}function Ne(a){let e,r,t,s;return{c(){e=w("button"),r=D("Join game")},l(n){e=b(n,"BUTTON",{});var o=E(e);r=T(o,"Join game"),o.forEach(d)},m(n,o){O(n,e,o),f(e,r),t||(s=Q(e,"click",a[3]),t=!0)},p:R,d(n){n&&d(e),t=!1,s()}}}function ue(a){let e,r;return e=new ze({props:{errorMsg:a[0].error}}),{c(){x(e.$$.fragment)},l(t){ee(e.$$.fragment,t)},m(t,s){te(e,t,s),r=!0},p(t,s){const n={};s&1&&(n.errorMsg=t[0].error),e.$set(n)},i(t){r||(I(e.$$.fragment,t),r=!0)},o(t){N(e.$$.fragment,t),r=!1},d(t){re(e,t)}}}function Oe(a){let e,r,t,s,n,o,m,l,u,i=a[0].gameStatus+"",$,z,v=a[0].playerStatus+"",A,M,c,g,y,p,B,H,L,ae;function ne(h,j){if(h[0].playerStatus==="spectating")return Ne;if(h[0].playerStatus==="joined")return Ce}let V=ne(a),S=V&&V(a);p=new He({});let _=a[0].error&&ue(a);return{c(){e=w("meta"),r=P(),t=w("div"),s=w("header"),n=w("h1"),o=D("Your game code is: "),m=w("span"),l=D(a[1]),u=D(`
		GameState: `),$=D(i),z=D(" / PlayerState "),A=D(v),M=P(),c=w("sidebar"),S&&S.c(),g=P(),y=w("main"),x(p.$$.fragment),B=P(),_&&_.c(),this.h()},l(h){const j=ve("svelte-3l9ygt",document.head);e=b(j,"META",{name:!0,content:!0}),j.forEach(d),r=W(h),t=b(h,"DIV",{class:!0});var C=E(t);s=b(C,"HEADER",{class:!0});var q=E(s);n=b(q,"H1",{});var X=E(n);o=T(X,"Your game code is: "),m=b(X,"SPAN",{id:!0}),E(m).forEach(d),l=T(X,a[1]),X.forEach(d),u=T(q,`
		GameState: `),$=T(q,i),z=T(q," / PlayerState "),A=T(q,v),q.forEach(d),M=W(C),c=b(C,"SIDEBAR",{class:!0});var oe=E(c);S&&S.l(oe),oe.forEach(d),g=W(C),y=b(C,"MAIN",{class:!0});var le=E(y);ee(p.$$.fragment,le),le.forEach(d),B=W(C),_&&_.l(C),C.forEach(d),this.h()},h(){document.title="Snake",k(e,"name","description"),k(e,"content","Svelte snake app"),k(m,"id","gameCodeDisplay"),k(s,"class","svelte-1jjphom"),k(c,"class","svelte-1jjphom"),k(y,"class","svelte-1jjphom"),k(t,"class","wrapper svelte-1jjphom")},m(h,j){f(document.head,e),O(h,r,j),O(h,t,j),f(t,s),f(s,n),f(n,o),f(n,m),f(n,l),f(s,u),f(s,$),f(s,z),f(s,A),f(t,M),f(t,c),S&&S.m(c,null),f(t,g),f(t,y),te(p,y,null),f(t,B),_&&_.m(t,null),H=!0,L||(ae=Q(t,"click",a[2]),L=!0)},p(h,[j]){(!H||j&1)&&i!==(i=h[0].gameStatus+"")&&Z($,i),(!H||j&1)&&v!==(v=h[0].playerStatus+"")&&Z(A,v),V===(V=ne(h))&&S?S.p(h,j):(S&&S.d(1),S=V&&V(h),S&&(S.c(),S.m(c,null))),h[0].error?_?(_.p(h,j),j&1&&I(_,1)):(_=ue(h),_.c(),I(_,1),_.m(t,null)):_&&(fe(),N(_,1,1,()=>{_=null}),de())},i(h){H||(I(p.$$.fragment,h),I(_),H=!0)},o(h){N(p.$$.fragment,h),N(_),H=!1},d(h){d(e),h&&d(r),h&&d(t),S&&S.d(),re(p),_&&_.d(),L=!1,ae()}}}function Pe(a,e,r){let t,s;U(a,J,i=>r(0,t=i)),U(a,Se,i=>r(5,s=i));const n=s.data.room,o=s.data;function m(){console.log("develop",t.gameStatus),t.playerStatus===ie.spectating?G({type:"join-game",msg:n}):t.playerStatus===ie.joined&&G({type:"player-ready"})}function l(){G({type:"join-game",msg:n})}function u(){G({type:"player-ready"})}return se(async()=>{be("ws://localhost:3100/room",o)}),[t,n,m,l,u]}class Ve extends K{constructor(e){super(),Y(this,e,Pe,Oe,F,{})}}export{Ve as default};

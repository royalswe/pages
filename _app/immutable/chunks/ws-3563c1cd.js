import{w as m}from"./index-a12d2336.js";const b={BG:"purple",SNAKE:"green",FOOD:"orange"},u={spectating:"spectating",joined:"joined",ready:"ready"},g=m({board:{},messages:[],gameStatus:"waiting",playerStatus:"spectating"}),n={subscribe:g.subscribe,update:g.update,set:g.set,setGameStatus:e=>g.update(t=>({...t,gameStatus:e})),setPlayerStatus:e=>g.update(t=>({...t,playerStatus:e})),setCounter:e=>g.update(t=>{return t.playerStatus=e,t;//!\\ this is important! Don't forget it
})},l=()=>{const{set:e,update:t,subscribe:s}=m(0);return{subscribe:s,update:t,set:e}},p=l();var o=(e=>(e.chatMessage="chat-message",e.error="error",e.gameState="game-state",e.gameStatus="game-status",e.gameOver="gameOver",e.joinGame="join-game",e.joinRoom="join-room",e.movement="movement",e.playerReady="player-ready",e.playerStatus="player-status",e))(o||{});let r;const y=(e,t)=>{if(console.log("url: "+e),r=new WebSocket(e),!r){n.update(s=>({...s,error:"Unable to connect"}));return}r.addEventListener("open",()=>{console.log("open :)"),t&&(console.log("Connected! lets join "+t.room),r.send(JSON.stringify({type:"join-room",params:t})))}),r.addEventListener("message",s=>{var d,i;const a=JSON.parse(s.data);switch(console.log(a),a.type){case o.gameState:p.set(a.msg);break;case o.playerStatus:n.setPlayerStatus(a.msg);break;case o.gameStatus:n.setGameStatus(a.msg);break;case o.joinRoom:n.update(c=>({...c,board:{width:a.width,height:a.height}}));break;case o.chatMessage:n.update(c=>({...c,messages:[a.msg].concat(c.messages)}));break;case o.gameOver:n.setCounter(u.joined),console.log("winner is:",(i=(d=a.msg)==null?void 0:d.gamestate)==null?void 0:i.color);break;case o.error:n.update(c=>({...c,error:a.msg}));break;default:console.log("unknown emit from server");break}}),r.addEventListener("close",s=>{console.log("Disconnected:",s)}),r.addEventListener("error",s=>{console.log("websocket error:",s)})},w=e=>{r.send(JSON.stringify(e))};export{b as C,u as P,w as a,p as b,y as c,n as s};
